#:import F kivy.factory.Factory
#:import ListAdapter kivy.adapters.listadapter.ListAdapter
#:import sla kivy.adapters.simplelistadapter
#:import label kivy.uix.label


<Main>:
    #id:     _main
    AnchorLayout:
        anchor_x:   'left'
        anchor_y:   'top'

        GeneralOptions:
            id:         _general_options
            height: 40
            width:  1000
            size_hint: None, None


    AnchorLayout:
        anchor_x:   'left'
        anchor_y:   'center'

        BoxLayout:
            id: _main_screen
            orientation: "horizontal"
            size:       (600, 400)
            size_hint:  (None, -0.3)

            Etap_info:
                id:     _etap_info
                size_hint: None, None



            Out_info:
                id:     _label
                size_hint: None, None
                #width:      root.width - _general_options.width
                #height:     root.height - _general_options.height

    AnchorLayout:
        anchor_x:   'left'
        anchor_y:   'bottom'

        Indicate:
            id:     _indicate
            size_hint: None, None








<GeneralOptions@BoxLayout>:
    orientation:    'horizontal'
    padding:        2
    height: 48


    Button:
        dd_1: dd_1.__self__
        dd_2: dd_2.__self__
        dd_4: dd_4.__self__
        dd_5: dd_5.__self__
        dd_6: dd_6.__self__
        id: btn1
        text: 'Контроль'
        on_release: dropdown1.open(self)
        on_press: app.root.ids._etap_info.visible = False
        height: '48dp'


        DropDown:
            id: dropdown1

            Button:
                text: 'Режим'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown1.select('Режим')
                on_press:   app.read_pam()

            Button:
                text: 'КолЦикл'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown1.select('КолЦикл')
                on_press:   F.Count_circle().open()
            Button:
                text: 'Вып'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown1.select('Вып')
                on_press:   app.upd_ltxt()
                id: dd_1

            Button:
                text: 'Печать'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown1.select('Печать')

    Button:
        text: 'Отладка'
        #on_release: dropdown2.open(self)
        #on_press:   F.Test_menu().open()

        on_press: app.root.ids._etap_info.visible = True
        height: '48dp'
        id: btn2
        DropDown:
            id: dropdown2

            Button:
                text: 'ЭтНач'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown2.select('ЭтНач')
                on_press:   app.print_out()
                id: dd_2

            Button:
                text: 'ЭтКон'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown2.select('ЭтКон')
                on_press:   F.Count_circle().open()
            Button:
                text: 'Шаг'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown2.select('Шаг')
            Button:
                text: 'Модификация'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown2.select('Модификация')
            Button:
                text: 'Режим'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown2.select('Режим')
            Button:
                text: 'КолЦиклов'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown2.select('КолЦиклов')
            Button:
                text: 'Выполнить'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown2.select('Выполнить')


    Button:
        text: 'РучРеж'
        on_release: dropdown3.open(self)
        on_press: app.root.ids._etap_info.visible = False
        height: '48dp'
        id: btn3
        DropDown:
            id: dropdown3

            Button:
                text: 'ОбнулУСО'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown3.select('ОбнулУСО')
                id: dd_4


            Button:
                text: 'ПускРГ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown3.select('ПускРГ')

            Button:
                text: 'ПускЗУ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown3.select('ПускЗУ')
            Button:
                text: 'ЦиклУСО_РГ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown3.select('ЦиклУСО_РГ')
            Button:
                text: 'ЦиклПВМ_Мод'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown3.select('ЦиклПВМ_Мод')
            Button:
                text: 'УпрПрМод'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown3.select('УпрПрМод')
            Button:
                text: 'ИпуZup'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown3.select('ИпуZup')
            Button:
                text: 'УпрZup'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown3.select('УпрZup')
    Button:
        text: 'Высветка'
        on_release: dropdown4.open(self)
        on_press: app.root.ids._etap_info.visible = False
        height: '48dp'
        id: btn4
        DropDown:
            id: dropdown4
            Button:
                text: 'КоордРег'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown4.select('КоордРег')
                id: dd_5
            Button:
                text: 'Чт/Зп Рг'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown4.select('Чт/Зп Рг')
            Button:
                text: 'КоордЗУ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown4.select('КоордЗУ')
            Button:
                text: 'Чт/Зп ЗУ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown4.select('Чт/Зп ЗУ')
                on_press:   app.read_pam()
                on_press:   F.ReadMem().open()
            Button:
                text: 'ЧтБуфВыд'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown4.select('ЧтБуфВыд')
            Button:
                text: 'ЧтЭтапа'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown4.select('ЧтЭтапа')
            Button:
                text: 'ЧтННормДиск'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown4.select('ЧтННормДиск')
            Button:
                text: 'УпрZup'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown4.select('УпрZup')
    Button:
        text: 'Параметры'
        on_release: dropdown5.open(self)
        on_press: app.root.ids._etap_info.visible = False
        height: '48dp'
        id: btn5
        DropDown:
            id: dropdown5
            Button:
                text: 'ОстНеисправность'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('КоордРег')
                id: dd_6
            Button:
                text: 'Пауза'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('Чт/Зп Рг')
                on_press:   F.Pause().open()
            Button:
                text: 'БлокИндЭтапа'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('КоордЗУ')
            Button:
                text: 'ЗапрУСО'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('Чт/Зп ЗУ')
            Button:
                text: 'ПоэтапОСТ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('ЧтБуфВыд')
            Button:
                text: 'ПошагОСТ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('ЧтЭтапа')
            Button:
                text: 'МодОСТ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('ЧтННормДиск')
            Button:
                text: 'ОстФГ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('УпрZup')
            Button:
                text: 'ИндикацияСрав'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('УпрZup')
            Button:
                text: 'Блок КПН'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('УпрZup')
            Button:
                text: 'Блок ДСЧ'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('УпрZup')
            Button:
                text: 'ЗапННДиск'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('УпрZup')
            Button:
                text: 'БлокZUP'
                size_hint_y: None
                height: '48dp'
                on_release: dropdown5.select('УпрZup')
    Button:
        text: 'Выход'
        height: '48dp'
        id: exit_button
        on_press:   app.stop()



<Out_info@BoxLayout>:
    orientation: "vertical"
    size:       (200, 420)
    size_hint:  (None, None)
    id:         label_show


    BoxLayout:
        orientation: "horizontal"
        size:       (600, 120)
        size_hint:  (None, None)

        Label:
            text:   'Факт. значение'
            markup: True
        Label:
            text:   'Эталон'
            markup: True
        Label:
            text:   'Допуск'
            markup: True
        Label:
            text:   'Норма/Не Норма'
            markup: True
            

    BoxLayout:
        orientation: "horizontal"
        size:       (600, 170)
        size_hint:  (None, None)

        ListView:
            size_hint_y: 1
            id:     _income_data
            adapter:
                sla.SimpleListAdapter(
                data=[],
                cls=label.Label)
        ListView:
            size_hint_y: 1
            id:     _etalon_data
            adapter:
                sla.SimpleListAdapter(
                data=[],
                cls=label.Label)
        ListView:
            size_hint_y: 1
            adapter:
                sla.SimpleListAdapter(
                data=app.my_data,
                cls=label.Label)
        ListView:
            size_hint_y: 1
            id:     _result
            adapter:
                sla.SimpleListAdapter(
                data=app.my_data,
                cls=label.Label)






<Count_circle@Popup>
    id:        amount_circle
    title:     "Ввод циклов"
    size:       (450, 200)
    size_hint : (None,None)

    BoxLayout:
        orientation: "horizontal"
        size:       (200, 120)
        size_hint:  (None, None)
        BoxLayout:
            orientation: "vertical"
            size:       (200, 120)
            size_hint:  (None, None)

            Label:
                text: "Введите количество циклов"
                size_hint:  (1, 0.2)

            TextInput:
                id: count_circle
                size_hint:  (1, 0.2)
                text: ""
                input_filter: 'int'

            Button:
                size_hint:  (1, 0.2)
                text:           "Подтвердить"
                on_release:     app.count_cirkles = app.check_enter((count_circle.text))
                on_release:     amount_circle.dismiss()


        Label:
            id:     count_cirkles_label
            markup: True
            size_hint:  (None, None)
            size:       (200, 120)
            text:   'Текущее кол-во циклов:\n' + str(app.count_cirkles)


<Pause@Popup>
    id:        pause_time
    title:     "Время паузы"
    size:       (450, 200)
    size_hint : (None,None)

    BoxLayout:
        orientation: "horizontal"
        size:       (200, 120)
        size_hint:  (None, None)
        BoxLayout:
            orientation: "vertical"
            size:       (200, 120)
            size_hint:  (None, None)

            Label:
                text: "Время паузы в секундах"
                size_hint:  (1, 0.2)

            TextInput:
                id: sleep_time
                size_hint:  (1, 0.2)
                text: ""
                input_filter: 'int'

            Button:
                size_hint:  (1, 0.2)
                text:           "Подтвердить"
                on_release:     app.pause_time = app.check_enter((sleep_time.text))
                on_release:     pause_time.dismiss()


        Label:
            id:     count_cirkles_label
            markup: True
            size_hint:  (None, None)
            size:       (200, 120)
            text:   'Текущяя пауза:\n' + str(app.pause_time)


<TextInput_List@BoxLayout>:

    text: '5'
    id: _text_
    TextInput:
        padding: (8, 1, 2, 1)
        halign: 'middle'
        size_hint_x: .8
        multiline: 'False'
        input_filter: 'int'
        text:       root.text
        on_text:    root.a_number = self.text
        on_text: if self.focus: app.data_mem_read[root.row_id]['text'] = self.text

<Label_List@BoxLayout>:

    a_number: '5'
    Label:
        text: root.a_number



<ReadMem@Popup>
    id:        read_mem
    title:     "Чтение/Запись Памяти"
    size:       (650, 600)
    size_hint : (None,None)

    BoxLayout:
        orientation: "vertical"
        size:       (400, 800)
        size_hint:  (None, None)

        BoxLayout:
            orientation: "horizontal"
            size:       (350, 420)
            size_hint:  (None, None)

            RecycleView:
                id: label_list_adreses
                scroll_type: ['bars', 'content']
                scroll_wheel_distance: dp(114)
                bar_width: dp(10)
                viewclass:  'Label_List'
                data:       app.adress_pam

                RecycleBoxLayout:
                    default_size: None, dp(20)
                    default_size_hint: None, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: dp(2)

            RecycleView:
                id: memory_data
                scroll_type: ['bars', 'content']
                scroll_wheel_distance: dp(114)
                bar_width: dp(10)
                viewclass:  'TextInput_List'
                data:       app.data_mem_read

                RecycleBoxLayout:
                    id: boxxxx
                    default_size: None, dp(20)
                    default_size_hint: None, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: dp(2)

            AnchorLayout:
                anchor_x:   'right'
                anchor_y:   'center'
                BoxLayout:
                    orientation: "vertical"
                    size_hint:  (None, None)
                    Button:
                        size:       (100, 30)
                        size_hint:  (None, None)
                        text:           "Вверх"
                        on_release:   app.up_pam()

                        on_release:   read_mem.dismiss()
                        on_release:   F.ReadMem().open()
                    Button:
                        size:       (100, 30)
                        size_hint:  (None, None)
                        text:           "Вниз"

                        on_release:   read_mem.dismiss()
                        on_release:   app.down_pam()

                        on_release:   F.ReadMem().open()





        Button:
            size:       (100, 50)
            size_hint:  (None, None)
            text:           "Подтвердить"
            on_release:     read_mem.dismiss()
        Button:
            size:       (100, 50)
            size_hint:  (None, None)
            text:           "Плюсуй"
            on_release:     print(root.ids.memory_data.data)



<Etap_info@BoxLayout>
    orientation: "vertical"
    size:       (300, 265)
    size_hint:  (None, None)
    visible: False
    #size_hint_x: 1 if self.visible else 0
    opacity: 1 if self.visible else 0
    disabled: not self.visible

    BoxLayout:
        size:       (300, 120)
        orientation: "horizontal"
        size_hint:  (1, 1)
        Label:
            text: "ЭтНач"
            size_hint:  (None, None)
            size:       (120, 35)

        TextInput:
            id: _etap_nach
            text: "1"
            size_hint:  (None, None)
            size:       (80, 35)
            input_filter: 'int'
    BoxLayout:
        size:       (300, 120)
        orientation: "horizontal"
        size_hint:  (1, 1)
        Label:
            text: "ЭтКон"
            size_hint:  (None, None)
            size:       (120, 35)

        TextInput:
            id: _etap_kon
            text: "1"
            size_hint:  (None, None)
            size:       (80, 35)
            input_filter: 'int'
    BoxLayout:
        size:       (300, 120)
        orientation: "horizontal"
        size_hint:  (1, 1)
        Label:
            text: "Шаг"
            size_hint:  (None, None)
            size:       (120, 35)

        TextInput:
            id: _shag
            text: "0"
            size_hint:  (None, None)
            size:       (80, 35)
            input_filter: 'int'
    BoxLayout:
        size:       (300, 120)
        orientation: "horizontal"
        size_hint:  (1, 1)
        Label:
            text: "Мод"
            size_hint:  (None, None)
            size:       (120, 35)

        TextInput:
            id: _mod
            text: "0"
            size_hint:  (None, None)
            size:       (80, 35)
            input_filter: 'int'

    BoxLayout:
        size:       (300, 120)
        orientation: "horizontal"
        size_hint:  (1, 1)
        Label:
            text: "Режим"
            size_hint:  (None, None)
            size:       (120, 35)

        TextInput:
            id: _rezim
            text: "0"
            size_hint:  (None, None)
            size:       (80, 35)
            input_filter: 'int'
    BoxLayout:
        size:       (300, 120)
        orientation: "horizontal"
        size_hint:  (1, 1)
        Label:
            text: "Кол-во циклов"
            size_hint:  (None, None)
            size:       (120, 35)

        TextInput:
            id: _cycles
            text: "1"
            size_hint:  (None, None)
            size:       (80, 35)
            input_filter: 'int'


    #disabled: not self.visible

    Button:
        id: _button_test
        #size_hint:  (1, 0.2)
        text:           "Выполнить"
        #on_press: root.visible = False
        on_press:     app.otladka()

<Indicate@BoxLayout>:
    orientation: "horizontal"
    size:       (200, 420)
    size_hint:  (None, None)
    id:         _indicate

    Label:
        text: "Этап"
        size_hint:  (None, None)
        size:       (40, 35)
    Label:
        id: _etap_indicate
        size_hint:  (None, None)
        size:       (50, 35)

    Label:
        text: "Шаг"
        size_hint:  (None, None)
        size:       (30, 35)
    Label:
        id: _shag_indicate
        size_hint:  (None, None)
        size:       (70, 35)

    Label:
        text: "Мод"
        size_hint:  (None, None)
        size:       (20, 35)
    Label:
        id: _mod_indicate
        size_hint:  (None, None)
        size:       (70, 35)

    Label:
        text: "Цикл"
        size_hint:  (None, None)
        size:       (20, 35)
    Label:
        id: _cycles_indicate
        size_hint:  (None, None)
        size:       (45, 35)

    Label:
        id: _norma
        size_hint:  (None, None)
        size:       (120, 35)

